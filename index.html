<html>
<head>
    <meta charset='utf-8'>
</head>
<body>
<script src="static/jquery.min.js"></script>
<script src="static/mqttws31.min.js"></script>
    <div style='text-align:center'>
        <div style='text-align:left: width:370px;background:#eeeeee;margin:0 auto;display:inline-block;padding:40px;border-radius:10px'>
            <div>
                md5解密
                <input style='width:300px' id='m1'>
                <button  onclick='dec()'>解密</button>
            </div>
            <div>
                结果: <span id='d1'>
            </div>
        </div>
    </div>
    <script>
        var clientId = "clientId" + new Date().getTime() +'_' + Math.random();
        client = new Paho.MQTT.Client("am.appxc.com", Number(8084), clientId);
        client.onConnectionLost = onConnectionLost;
        client.onMessageArrived = onMessageArrived;
        client.connect({useSSL:true,onSuccess:onConnect});

        function onConnect() {
            console.log("onConnect");
            client.subscribe(clientId);
        }

        function onConnectionLost(responseObject) {
            if (responseObject.errorCode !== 0) {
                console.log("onConnectionLost:"+responseObject.errorMessage);
                $('#d1').html('断开链接，刷新重试')
            }
        }

        function onMessageArrived(message) {
            console.log("onMessageArrived:"+message.payloadString);
            var data = JSON.parse(message.payloadString);
            if(data.code==200){
                $('#d1').html(data.text)
            }
            setTimeout(function () {
                if($('#d1').html().trim()==''){
                    $('#d1').html('未找到')
                }
            },1500)
        }

        function dec(){
            $('#d1').html('')
            var payload = {
                clientId:clientId,
                md5:$('#m1').val()
            }
            var message = new Paho.MQTT.Message(JSON.stringify(payload));
            message.destinationName = 'md5store';
            client.send(message);
        }


    </script>
</body>
</html>